# W1 Day3 學習紀錄

## 🎯 今日目標
- **任務 A**：建立 CLI 路由  
  - 支援 `convert` 子命令（時區/格式轉換）  
  - 支援 `log` 子命令（改成 logging 系統：console + file + rotating）  
- **任務 B**：實作錯誤處理範例 & 測試  
  - 定義三類自訂錯誤：`UserInputError`, `DomainRuleError`, `SystemError`  
  - 實作示範函式：`parse_age`, `apply_discount`, `read_config`  
  - 撰寫 pytest 驗證錯誤情境  

---

## 📂 完成的檔案
- `week1/src/cli.py`  
  - argparse 子命令架構：`convert`、`log`  
  - logging：console + file + rotating handler  
- `week1/src/app_errors.py`  
  - 定義錯誤基底 `AppError` 及三個子類別  
  - 提供 `map_error()` 方便對應 error_code  
- `week1/src/error_examples.py`  
  - 錯誤處理示範函式（輸入驗證 / 商業規則 / 系統錯誤）  
- `week1/tests/test_error_examples.py`  
  - 驗證三個函式會正確丟對應的錯誤  
- `week1/tests/test_cli_convert_errors.py`  
  - 驗證 CLI `convert` 子命令在錯誤情境下會正確輸出錯誤訊息  

---

## ✅ 測試結果
```bash
pytest week1/tests -v
```

所有測試通過 (42 tests + CLI error tests all pass) 🎉  

---

## 📌 學到的重點
1. **CLI 架構設計**  
   - 使用 argparse 建立子命令，分離不同功能（convert / log）  
   - `python -m week1.src.cli convert ...` 更穩健，避免相對匯入錯誤  

2. **Logging 實務**  
   - Console 與檔案同時輸出  
   - 支援輪轉檔案（RotatingFileHandler），避免 log 檔無限增長  
   - 可透過 `.env` 控制 log level  

3. **錯誤處理模式**  
   - 統一的錯誤基底類別，子類別專責不同領域：  
     - `UserInputError` → 使用者輸入錯誤  
     - `DomainRuleError` → 商業規則違反  
     - `SystemError` → 系統/環境錯誤  
   - 錯誤要有 error_code + message，方便上層處理或對應 API code  

4. **測試技巧**  
   - 用 `pytest.raises` 驗證錯誤是否正確丟出  
   - 測 CLI 時，建議用 `python -m` 執行套件，並設定 `cwd` 在專案根，避免 Windows/相對路徑問題  

---

## 📊 Day3 成果
- [x] CLI 子命令系統  
- [x] logging 機制  
- [x] 自訂錯誤類別  
- [x] pytest 錯誤處理測試全部通過  

👉 **Day3 目標達成 🎯**
